name: Validate Agents & Documentation

on:
  push:
    branches: [main, master, develop]
  pull_request:
    branches: [main, master, develop]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  validate-agents:
    name: Validate Agent Configurations
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup PowerShell
        shell: pwsh
        run: |
          $PSVersionTable.PSVersion
      
      - name: Validate agents
        shell: pwsh
        run: |
          ./scripts/validate-agents.ps1
      
      - name: Check context size
        shell: pwsh
        run: |
          ./scripts/check-context-size.ps1

  validate-docs:
    name: Validate Documentation Links
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup PowerShell
        shell: pwsh
        run: |
          $PSVersionTable.PSVersion
      
      - name: Validate documentation links
        shell: pwsh
        run: |
          ./scripts/validate-docs.ps1



  validation-summary:
    name: Validation Summary
    runs-on: ubuntu-latest
    needs: [validate-agents, validate-docs]
    if: always()

    steps:
      - name: Check validation results
        run: |
          echo "Agent Validation: ${{ needs.validate-agents.result }}"
          echo "Documentation Validation: ${{ needs.validate-docs.result }}"

          if [ "${{ needs.validate-agents.result }}" != "success" ] || \
             [ "${{ needs.validate-docs.result }}" != "success" ]; then
            echo "::error::One or more validation checks failed"
            exit 1
          fi

          echo "âœ… All validation checks passed!"
